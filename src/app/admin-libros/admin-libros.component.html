<div class="container mt-0">
  <h2 class="mb-4 text-center">Lista de Libros</h2>

  <div class="mb-3">
    <button
      type="button"
      class="btn custom-button rounded-pill"
      (click)="abrirModalCrear()"
      data-bs-toggle="modal"
      data-bs-target="#modalLibro"
    >
      Añadir Libro
    </button>
  </div>

  <form class="row g-2 mb-3 align-items-center" (ngSubmit)="buscar()">
    <div class="col-auto">
      <select
        class="form-select rounded-pill"
        [(ngModel)]="filtro"
        name="filtro"
      >
        <option value="id">ID</option>
        <option value="titulo">Título</option>
        <option value="autor">Autor</option>
        <option value="genero">Género</option>
      </select>
    </div>
    <div class="col-auto flex-grow-1">
      <input
        [type]="filtro === 'id' ? 'number' : 'text'"
        class="form-control rounded-pill"
        [placeholder]="
          'Buscar por ' + filtro.charAt(0).toUpperCase() + filtro.slice(1)
        "
        [(ngModel)]="valorBusqueda"
        name="valorBusqueda"
        [min]="filtro === 'id' ? 1 : null"
      />
    </div>
    <div class="col-auto">
      <button type="submit" class="btn custom-button rounded-pill">
        Buscar
      </button>
    </div>
    <div class="col-auto">
      <button
        type="button"
        class="btn custom-button-secondary rounded-pill"
        (click)="cargarLibros()"
      >
        Limpiar
      </button>
    </div>
  </form>

  <div class="table-responsive">
    <table class="table custom-table align-middle">
      <colgroup>
        <col style="width: 5%" />
        <!-- ID -->
        <col style="width: 20%" />
        <!-- Título -->
        <col style="width: 15%" />
        <!-- Autor -->
        <col style="width: 20%" />
        <!-- Año -->
        <col style="width: 13%" />
        <!-- Género -->
        <col style="width: 20%" />
        <!-- Acciones -->
      </colgroup>
      <thead>
        <tr>
          <th>ID</th>
          <th>Título</th>
          <th>Autor</th>
          <th>Año de Publicación</th>
          <th>Género</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="
            let libro of libros
              | paginate : { itemsPerPage: 5, currentPage: page }
          "
        >
          <td>{{ libro.idLibro }}</td>
          <td>{{ libro.titulo }}</td>
          <td>{{ libro.autor }}</td>
          <td>{{ libro.anioPublicacion }}</td>
          <td>{{ libro.genero }}</td>
          <td>
            <button
              class="btn btn-sm custom-button rounded-pill me-2"
              (click)="abrirModalEditar(libro)"
              data-bs-toggle="modal"
              data-bs-target="#modalLibro"
            >
              Editar
            </button>
            <button
              class="btn btn-sm custom-button-secondary rounded-pill"
              (click)="eliminarLibro(libro.idLibro)"
            >
              Eliminar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination-wrapper mt-3 d-flex justify-content-center">
    <pagination-controls
      previousLabel="Anterior"
      nextLabel="Siguiente"
      (pageChange)="page = $event"
    ></pagination-controls>
  </div>

  <div
    class="modal fade"
    id="modalLibro"
    tabindex="-1"
    aria-labelledby="modalLibroLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="border-radius: 18px">
        <div class="modal-header" style="background: #36304a">
          <h5 class="modal-title text-white" id="modalLibroLabel">
            {{
              accionModal === "crear" ? "Añadir Nuevo Libro" : "Editar Libro"
            }}
          </h5>
          <button
            type="button"
            class="btn-close btn-close-white"
            data-bs-dismiss="modal"
            aria-label="Cerrar"
          ></button>
        </div>
        <form (ngSubmit)="guardarLibro()" #formLibro="ngForm">
          <div class="modal-body" style="background: #eceaf3">
            <div class="mb-3">
              <label class="form-label">Título</label>
              <input
                type="text"
                class="form-control rounded-pill"
                [(ngModel)]="libroEditando.titulo"
                name="titulo"
                required
              />
            </div>
            <div class="mb-3">
              <label class="form-label">Autor</label>
              <input
                type="text"
                class="form-control rounded-pill"
                [(ngModel)]="libroEditando.autor"
                name="autor"
                required
              />
            </div>
            <div class="mb-3">
              <label class="form-label">Año de Publicación</label>
              <input
                type="number"
                class="form-control rounded-pill"
                [(ngModel)]="libroEditando.anioPublicacion"
                name="anioPublicacion"
                required
              />
            </div>
            <div class="mb-3">
              <label class="form-label">Género</label>
              <input
                type="text"
                class="form-control rounded-pill"
                [(ngModel)]="libroEditando.genero"
                name="genero"
                required
              />
            </div>
          </div>
          <div class="modal-footer" style="background: #eceaf3">
            <button
              type="button"
              class="btn custom-button-secondary rounded-pill"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button
              type="submit"
              class="btn custom-button rounded-pill"
              [disabled]="formLibro.invalid"
              data-bs-dismiss="modal"
            >
              {{ accionModal === "crear" ? "Guardar" : "Guardar Cambios" }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
